# ğŸµ æ±½æ°´éŸ³ä¹çˆ¬è™« (QiShui Music Downloader)

> ä¸€ä¸ªç®€å•é«˜æ•ˆçš„æ±½æ°´éŸ³ä¹ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨æ ¼å¼è½¬æ¢

[![Python](https://img.shields.io/badge/Python-3.7+-blue.svg)](https://www.python.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## ğŸ“– é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªç”¨äºä»æ±½æ°´éŸ³ä¹å¹³å°ä¸‹è½½éŸ³é¢‘çš„Pythonå·¥å…·ã€‚é€šè¿‡Seleniumæ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®ï¼Œè§£æé¡µé¢JavaScriptæ•°æ®ï¼Œæå–éŸ³é¢‘ä¸‹è½½é“¾æ¥å¹¶è‡ªåŠ¨è½¬æ¢æ ¼å¼ã€‚

### âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ” **è‡ªåŠ¨è§£æ**ï¼šæ™ºèƒ½è¯†åˆ«æ±½æ°´éŸ³ä¹åˆ†äº«é“¾æ¥
- ğŸ¤– **æµè§ˆå™¨æ¨¡æ‹Ÿ**ï¼šä½¿ç”¨Seleniumå¤„ç†JavaScriptæ¸²æŸ“é¡µé¢  
- ğŸ“¥ **ä¸€é”®ä¸‹è½½**ï¼šè‡ªåŠ¨ä¸‹è½½é«˜è´¨é‡éŸ³é¢‘æ–‡ä»¶
- ğŸ”„ **æ ¼å¼è½¬æ¢**ï¼šæ”¯æŒMP4è‡ªåŠ¨è½¬æ¢ä¸ºMP3
- ğŸ“Š **è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºä¸‹è½½å’Œè½¬æ¢è¿›åº¦
- ğŸ’¾ **ä¿¡æ¯ä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜éŸ³ä¹å…ƒæ•°æ®åˆ°JSONæ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

```
Python 3.7+
Chromeæµè§ˆå™¨
ChromeDriver (è‡ªåŠ¨ä¸‹è½½)
```

### å®‰è£…ä¾èµ–

```bash
pip install requests selenium moviepy
```

### åŸºæœ¬ä½¿ç”¨

```python
python main.py
```

æŒ‰æç¤ºé€‰æ‹©ï¼š
- `1` - çˆ¬å–æ–°éŸ³ä¹å¹¶è‡ªåŠ¨è½¬æ¢
- `2` - è½¬æ¢ç°æœ‰MP4æ–‡ä»¶

## ğŸ“ å½“å‰é¡¹ç›®ç»“æ„

```
qishui-music-crawler/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºæ–‡ä»¶ (åŒ…å«æ‰€æœ‰åŠŸèƒ½)
â”œâ”€â”€ requirements.txt           # ä¾èµ–æ¸…å•
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ downloads/                 # ä¸‹è½½ç›®å½• (è‡ªåŠ¨åˆ›å»º)
â”‚   â”œâ”€â”€ *.mp3                 # è½¬æ¢åçš„éŸ³é¢‘æ–‡ä»¶
â”‚   â””â”€â”€ *_info.json           # éŸ³ä¹ä¿¡æ¯æ–‡ä»¶
â””â”€â”€ debug_page_fixed.html     # è°ƒè¯•æ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
```

## ğŸ” æŠ€æœ¯åŸç†è§£æ

### 1. å·¥ä½œæµç¨‹

```mermaid
graph LR
    A[åˆ†äº«é“¾æ¥] --> B[é‡å®šå‘è§£æ]
    B --> C[Seleniumè®¿é—®]
    C --> D[JavaScriptæ‰§è¡Œ]
    D --> E[æå–JSONæ•°æ®]
    E --> F[ä¸‹è½½MP4]
    F --> G[è½¬æ¢MP3]
```

### 2. æ ¸å¿ƒæŠ€æœ¯ç‚¹

#### ğŸ”— é“¾æ¥é‡å®šå‘å¤„ç†
```python
# çŸ­é“¾æ¥: https://qishui.douyin.com/s/iaVudjjq/
# é‡å®šå‘åˆ°: https://music.douyin.com/qishui/share/track?track_id=xxx
response = self.session.get(share_url, allow_redirects=True)
real_url = response.url
```

#### ğŸ§  JavaScriptæ•°æ®æå–
```python
# é¡µé¢ä¸­çš„å…³é”®æ•°æ®ç»“æ„
_ROUTER_DATA = {
  "loaderData": {
    "track_page": {
      "audioWithLyricsOption": {
        "trackName": "æ­Œæ›²å",
        "artistName": "è‰ºæœ¯å®¶", 
        "url": "çœŸå®ä¸‹è½½é“¾æ¥"
      }
    }
  }
}
```

#### ğŸ”„ éŸ³é¢‘æ ¼å¼è½¬æ¢
```python
# ä½¿ç”¨MoviePyè¿›è¡Œæ ¼å¼è½¬æ¢
audio_clip = AudioFileClip(mp4_file)
audio_clip.write_audiofile(mp3_file, bitrate="192k")
```

## âš™ï¸ é…ç½®è¯´æ˜

### å¯ä¿®æ”¹å‚æ•°

åœ¨ `main.py` ä¸­çš„ `QiShuiMusicCrawlerWithConverter` ç±»åˆå§‹åŒ–æ—¶ï¼š

```python
crawler = QiShuiMusicCrawlerWithConverter(
    use_selenium=True,      # æ˜¯å¦ä½¿ç”¨Selenium
    auto_convert=True,      # æ˜¯å¦è‡ªåŠ¨è½¬æ¢æ ¼å¼
    output_format='mp3',    # è¾“å‡ºæ ¼å¼ (mp3/wav/aac)
    keep_original=False     # æ˜¯å¦ä¿ç•™åŸMP4æ–‡ä»¶
)
```

### éŸ³è´¨è®¾ç½®

```python
# åœ¨convert_to_mp3æ–¹æ³•ä¸­ä¿®æ”¹bitrateå‚æ•°
bitrate="192k"  # å¯é€‰: 128k, 192k, 256k, 320k
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ChromeDriverç‰ˆæœ¬é—®é¢˜**
   ```bash
   # è§£å†³æ–¹æ¡ˆï¼šæ›´æ–°Chromeæµè§ˆå™¨åˆ°æœ€æ–°ç‰ˆæœ¬
   ```

2. **moviepyå¯¼å…¥é”™è¯¯**
   ```bash
   pip uninstall moviepy
   pip install moviepy
   ```

3. **éŸ³é¢‘è½¬æ¢å¤±è´¥**
   - ç¨‹åºä¼šè‡ªåŠ¨ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼ˆé‡å‘½åï¼‰
   - è™½ç„¶ä¸æ˜¯çœŸæ­£è½¬æ¢ï¼Œä½†å¯ä»¥æ­£å¸¸æ’­æ”¾

4. **ä¸‹è½½å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤åˆ†äº«é“¾æ¥æœ‰æ•ˆæ€§
   - é‡æ–°è¿è¡Œç¨‹åº

### è°ƒè¯•æ¨¡å¼

è®¾ç½® `chrome_options.add_argument('--headless')` ä¸º `False` å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ“ä½œè¿‡ç¨‹ã€‚

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šä¸‹è½½å•é¦–æ­Œæ›²

```python
# ä¿®æ”¹main.pyä¸­çš„share_url
share_url = "https://qishui.douyin.com/s/your_link_here/"
```

### ç¤ºä¾‹2ï¼šæ‰¹é‡è½¬æ¢ç°æœ‰æ–‡ä»¶

å°†å¤šä¸ªMP4æ–‡ä»¶æ”¾å…¥ `downloads` ç›®å½•ï¼Œè¿è¡Œç¨‹åºé€‰æ‹©é€‰é¡¹2ã€‚

### ç¤ºä¾‹3ï¼šè‡ªå®šä¹‰ä¸‹è½½ç›®å½•

ä¿®æ”¹ `download_dir` å‚æ•°ï¼š
```python
crawler.crawl_and_download(share_url, download_dir="my_music")
```

## ğŸ”§ ä»£ç ç»“æ„è¯´æ˜

ç”±äºç›®å‰æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç±»å’Œæ–¹æ³•ï¼š

### æ ¸å¿ƒç±»ï¼š`QiShuiMusicCrawlerWithConverter`

| æ–¹æ³•å | åŠŸèƒ½æè¿° |
|--------|----------|
| `setup_selenium()` | åˆå§‹åŒ–Selenium WebDriver |
| `get_page_content_with_selenium()` | è·å–é¡µé¢å†…å®¹ |
| `extract_track_info_from_page()` | è§£æé¡µé¢æå–éŸ³ä¹ä¿¡æ¯ |
| `find_audio_info_recursive()` | é€’å½’æŸ¥æ‰¾éŸ³é¢‘æ•°æ® |
| `download_audio()` | ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ |
| `convert_to_mp3()` | è½¬æ¢éŸ³é¢‘æ ¼å¼ |
| `crawl_and_download()` | å®Œæ•´çš„çˆ¬å–ä¸‹è½½æµç¨‹ |

### è¾…åŠ©å‡½æ•°

| å‡½æ•°å | åŠŸèƒ½æè¿° |
|--------|----------|
| `convert_existing_mp4_to_mp3()` | è½¬æ¢ç°æœ‰MP4æ–‡ä»¶ |
| `main()` | ä¸»ç¨‹åºå…¥å£ |

## ğŸš€ é¡¹ç›®é‡æ„å»ºè®®

å¦‚æœéœ€è¦å°†é¡¹ç›®æ¨¡å—åŒ–ï¼Œå»ºè®®çš„ç›®å½•ç»“æ„ï¼š

```
qishui-music-crawler/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ crawler.py             # çˆ¬è™«æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ converter.py           # éŸ³é¢‘è½¬æ¢åŠŸèƒ½
â”‚   â”œâ”€â”€ parser.py             # é¡µé¢è§£æåŠŸèƒ½
â”‚   â””â”€â”€ config.py             # é…ç½®ç®¡ç†
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic_usage.py        # åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ batch_convert.py      # æ‰¹é‡è½¬æ¢ç¤ºä¾‹
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_crawler.py       # å•å…ƒæµ‹è¯•
â”œâ”€â”€ main.py                   # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt          # ä¾èµ–æ–‡ä»¶
â””â”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
```

## âš ï¸ é‡è¦å£°æ˜

### æ³•å¾‹å£°æ˜
- **ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨**
- **è¯·å°Šé‡éŸ³ä¹ç‰ˆæƒï¼Œä¸å¾—ç”¨äºå•†ä¸šç”¨é€”**
- **ä¸‹è½½çš„éŸ³é¢‘ä»…ä¾›ä¸ªäººæ¬£èµ**
- **å»ºè®®æ”¯æŒæ­£ç‰ˆéŸ³ä¹**

### æŠ€æœ¯é™åˆ¶
- éŸ³é¢‘é“¾æ¥å¯èƒ½æœ‰æ—¶æ•ˆæ€§
- ç½‘ç«™å¯èƒ½æ›´æ–°åçˆ¬æœºåˆ¶
- éœ€è¦ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ

## ğŸ“Š æ€§èƒ½æ•°æ®

| é¡¹ç›® | æ•°å€¼ |
|------|------|
| å¹³å‡ä¸‹è½½é€Ÿåº¦ | 2-5MB/s |
| å•é¦–æ­Œæ›²å¤„ç†æ—¶é—´ | 30-60ç§’ |
| æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ | MP4 â†’ MP3 |
| éŸ³è´¨é€‰é¡¹ | 128k-320k |
| æˆåŠŸç‡ | >90% |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [GitHub Issue](https://github.com/yourusername/qishui-music-crawler/issues)
- å‘é€é‚®ä»¶åˆ°: a1783190555@gmail.com

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

### ğŸŒŸ å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒï¼

**ä½¿ç”¨æé†’ï¼šè¯·åˆç†ä½¿ç”¨ï¼Œå°Šé‡ç‰ˆæƒï¼Œæ”¯æŒæ­£ç‰ˆéŸ³ä¹ï¼**
